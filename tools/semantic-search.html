<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Semantic Search &mdash; Find Related Concepts &mdash; The Unveiled Word</title>
  <meta name="description" content="Search across all 35,405 pages with results grouped by category.">
  <link rel="stylesheet" href="../css/style.css?v6">
  
</head>
<body>

  <header class="site-header">
    <div class="nav-container">
      <a href="../" class="site-logo">The Unveiled Word</a>
      <button class="nav-toggle" aria-label="Toggle navigation">
        <span></span><span></span><span></span>
      </button>
      <ul class="nav-links">
        <li><a href="../studies/">Studies</a></li>
        <li><a href="../interlinear/">Interlinear</a></li>
        <li><a href="../lexicon/">Lexicon</a></li>
        <li><a href="../reference/">Reference</a></li>
        <li><a href="../tools/" class="active">Tools</a></li>
        <li><a href="../search.html">Search</a></li>
      </ul>
    </div>
  </header>

  <div class="book-page">
    <div class="illuminated-border">
      <div class="border-left"></div>
      <div class="border-right"></div>
      <div class="corner-tl"></div>
      <div class="corner-tr"></div>
      <div class="corner-bl"></div>
      <div class="corner-br"></div>

      <main class="page-container page-wide">
        <article class="study-article">
          <header class="study-header">
            <div class="study-category">Tools &bull; Search &bull; Advanced</div>
            <h1 class="study-title">Semantic Search</h1>
            <p class="study-subtitle">Search Across All 35,405 Pages &mdash; Studies, Lexicon, Reference &amp; Interlinear</p>
          </header>

          <section class="study-body">

<style>
  .big-search {
    width: 100%; padding: 1rem 1.5rem; font-size: 1.2rem; border: 3px solid var(--gold-leaf);
    border-radius: 12px; background: var(--vellum); color: var(--text-primary);
    font-family: var(--font-reading); box-sizing: border-box;
  }
  .big-search:focus { outline: none; box-shadow: 0 0 20px rgba(197,150,12,0.3); }
  .topic-suggestions { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 1rem 0; justify-content: center; }
  .topic-btn {
    padding: 0.4rem 1rem; border: 1px solid rgba(197,150,12,0.3); border-radius: 20px;
    background: var(--verse-bg); color: var(--text-primary); font-size: 0.85rem; cursor: pointer;
    font-family: var(--font-heading); transition: all 0.2s;
  }
  .topic-btn:hover { background: var(--highlight); border-color: var(--gold-leaf); }
  .result-group { margin: 1.5rem 0; }
  .group-label {
    font-family: var(--font-heading); font-size: 1rem; color: var(--gold-antique);
    border-bottom: 2px solid rgba(197,150,12,0.2); padding-bottom: 0.3rem; margin-bottom: 0.5rem;
  }
  .result-item {
    padding: 0.8rem 1rem; margin: 0.3rem 0; border-radius: 6px;
    border: 1px solid rgba(197,150,12,0.1); background: var(--verse-bg);
  }
  .result-item:hover { border-color: var(--gold-leaf); }
  .result-item a { color: var(--link-color); text-decoration: none; font-family: var(--font-heading); font-size: 0.95rem; }
  .result-item a:hover { text-decoration: underline; }
  .result-cat { font-size: 0.7rem; color: var(--gold-leaf); text-transform: uppercase; letter-spacing: 0.05em; font-family: var(--font-heading); margin-left: 0.5rem; }
  .result-snippet { font-size: 0.85rem; color: var(--text-faded); margin-top: 0.2rem; line-height: 1.5; font-family: var(--font-reading); }
  .result-count { text-align: center; color: var(--text-faded); font-size: 0.95rem; margin: 1rem 0; font-family: var(--font-reading); }
  .ss-loading { text-align: center; color: var(--gold-leaf); padding: 2rem; font-style: italic; font-family: var(--font-reading); }
</style>

<input type="text" class="big-search" id="q" placeholder="Try: grace, love, covenant, atonement, resurrection..." autofocus>
<div class="topic-suggestions" id="topics"></div>
<div class="result-count" id="count"></div>
<div id="results"></div>
<div class="ss-loading" id="loading" style="display:none;">Loading search index&hellip;</div>

<script>
const TOPICS = ["grace and mercy","resurrection","covenant","Holy Spirit","atonement","faith vs works","love","sin","prophecy fulfilled","kingdom of God","prayer","angels","hell sheol hades","baptism","creation","David","Abraham","Paul","Mary","Moses"];
const CATEGORY_ORDER = ["study","lexicon","reference","interlinear","parallel","tool"];
const CATEGORY_LABELS = {study:"Studies",lexicon:"Lexicon",reference:"Reference",interlinear:"Interlinear",parallel:"Parallel",tool:"Tools"};

let searchIndex = null, debounce = null;
const topicsEl = document.getElementById("topics");
TOPICS.forEach(t => {
  const btn = document.createElement("button");
  btn.className = "topic-btn"; btn.textContent = t;
  btn.onclick = () => { document.getElementById("q").value = t; doSearch(t); };
  topicsEl.appendChild(btn);
});
document.getElementById("q").addEventListener("input", e => { clearTimeout(debounce); debounce = setTimeout(() => doSearch(e.target.value), 300); });

function normalizeText(s) { return s.replace(/&rsquo;/g,"'").replace(/&ldquo;|&rdquo;/g,'"').replace(/&mdash;/g,"\u2014").replace(/&amp;/g,"&").replace(/&nbsp;/g," ").replace(/&#\d+;/g,""); }

async function loadIndex() {
  if (searchIndex) return;
  document.getElementById("loading").style.display = "block";
  const resp = await fetch("../search-index.json");
  searchIndex = await resp.json();
  document.getElementById("loading").style.display = "none";
}

async function doSearch(query) {
  if (!query || query.length < 2) { document.getElementById("results").innerHTML = ""; document.getElementById("count").textContent = ""; return; }
  await loadIndex();
  const terms = query.toLowerCase().split(/\s+/).filter(t => t.length > 1);
  const scored = [];
  searchIndex.forEach(entry => {
    const text = normalizeText((entry.n||"") + " " + (entry.t||"") + " " + (entry.d||"")).toLowerCase();
    const title = normalizeText(entry.n||"").toLowerCase();
    let score = 0, matchCount = 0;
    terms.forEach(term => { if (title.includes(term)) { score += 10; matchCount++; } else if (text.includes(term)) { score += 3; matchCount++; } });
    if (terms.length > 1 && text.includes(terms.join(" "))) score += 20;
    if (matchCount === 0) return;
    if (matchCount === terms.length) score += 15;
    if (entry.c === "study") score += 5;
    if (entry.c === "reference") score += 2;
    scored.push({...entry, score});
  });
  scored.sort((a,b) => b.score - a.score);
  const groups = {};
  scored.slice(0, 200).forEach(r => { const cat = r.c || "other"; if (!groups[cat]) groups[cat] = []; groups[cat].push(r); });
  let html = "";
  CATEGORY_ORDER.forEach(cat => {
    if (!groups[cat]) return;
    const items = groups[cat].slice(0, 50);
    html += '<div class="result-group"><div class="group-label">' + (CATEGORY_LABELS[cat]||cat) + ' (' + groups[cat].length + ')</div>' +
      items.map(r => {
        const snippet = normalizeText(r.t || r.d || "").substring(0, 150);
        return '<div class="result-item"><a href="../' + r.u + '">' + normalizeText(r.n||r.u) + '</a><span class="result-cat">' + (r.c||"") + '</span>' +
          (snippet ? '<div class="result-snippet">' + snippet + '...</div>' : '') + '</div>';
      }).join("") + '</div>';
  });
  Object.keys(groups).forEach(cat => {
    if (CATEGORY_ORDER.includes(cat)) return;
    const items = groups[cat].slice(0, 20);
    html += '<div class="result-group"><div class="group-label">' + cat + ' (' + groups[cat].length + ')</div>' +
      items.map(r => '<div class="result-item"><a href="../' + r.u + '">' + normalizeText(r.n||r.u) + '</a></div>').join("") + '</div>';
  });
  document.getElementById("count").textContent = scored.length + ' results for "' + query + '"';
  document.getElementById("results").innerHTML = html || '<p style="text-align:center;color:var(--text-faded)">No results found.</p>';
}
</script>

          </section>
        </article>
      </main>
    </div>
  </div>

  <div class="book-spine" aria-hidden="true"></div>

  <footer class="site-footer">
    <p class="footer-scripture">&ldquo;Your word is a lamp to my feet and a light to my path.&rdquo;</p>
    <p class="footer-ref">PSALM 119:105</p>
    <p class="footer-copy">The Unveiled Word &mdash; Soli Deo Gloria</p>
  </footer>

  <script src="../js/main.js?v3"></script>
  <script src="../js/audio-pronunciation.js?v6"></script>
  <script src="../js/bg-music.js?v6"></script>
  
</body>
</html>